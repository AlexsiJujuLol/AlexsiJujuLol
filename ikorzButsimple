local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local VirtualInputManager = game:GetService("VirtualInputManager")
local Player = Players.LocalPlayer

local AutoParryEnabled = true
local ReactionTime = 0.3
local DetectionRange = 100
local Cooldown = tick()
local Parried = false

local function GetClosestBall()
    local closestBall, closestDistance = nil, math.huge
    for _, Ball in ipairs(workspace.Balls:GetChildren()) do
        if Ball:GetAttribute("realBall") then
            local HRP = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
            if HRP then
                local Distance = (HRP.Position - Ball.Position).Magnitude
                if Distance < closestDistance then
                    closestDistance = Distance
                    closestBall = Ball
                end
            end
        end
    end
    return closestBall
end

RunService.Heartbeat:Connect(function()
    if not AutoParryEnabled then return end

    local Ball = GetClosestBall()
    local HRP = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
    if not Ball or not HRP then return end

    local BallVelocity = Ball.Velocity.Magnitude
    local Distance = (HRP.Position - Ball.Position).Magnitude
    local TimeToReach = Distance / BallVelocity

    if Ball:GetAttribute("target") == Player.Name and not Parried and Distance <= DetectionRange and TimeToReach <= ReactionTime then
        VirtualInputManager:SendMouseButtonEvent(0, 0, 0, true, game, 0)
        Parried = true
        Cooldown = tick()
    end

    if (tick() - Cooldown) >= 0.2 then
        Parried = false
    end
end)

local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()
local Window = Fluent:CreateWindow({
    Title = "ikorz - Auto Parry",
    SubTitle = "by ikorz bitch",
    Size = UDim2.fromOffset(580, 460),
    Theme = "Dark",
})

local Tabs = {
    Main = Window:AddTab({ Title = "Main", Icon = "" }),
}

local AutoParryToggle = Tabs.Main:AddToggle("AutoParryToggle", {
    Title = "Enable Auto Parry",
    Default = AutoParryEnabled,
    Callback = function(Value)
        AutoParryEnabled = Value
    end,
})

Fluent:Notify({
    Title = "Auto Parry Script",
    Content = "The script has been successfully loaded.",
    Duration = 5,
})

Window:SelectTab(1)
